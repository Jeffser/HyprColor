#!/usr/bin/python3

import subprocess, json, os, sys, random, shutil
if len(sys.argv) != 2: wallpaper_directory = os.path.expanduser("~/.config/hypr/wallpapers/anime")
else: wallpaper_directory = os.path.expanduser(sys.argv[1])
monitors = json.loads(subprocess.check_output("hyprctl -j monitors", shell=True).decode("utf-8"))
wallpapers = [os.path.join(wallpaper_directory, f) for f in os.listdir(wallpaper_directory) if os.path.isfile(os.path.join(wallpaper_directory, f))]
for monitor in monitors:
    wallpaper = random.choice(wallpapers)
    wallpapers.remove(wallpaper)
    if monitor['id'] == 0 and shutil.which("update-theme") is not None: os.system("update-theme " + wallpaper)
    os.system(f"hyprctl hyprpaper preload {wallpaper}")
    os.system(f"hyprctl hyprpaper wallpaper '{monitor['name']},{wallpaper}'")